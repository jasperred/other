<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ami.ec.channel.dao.officialPlugin.OfficialServicesMapper">
	<resultMap id="BaseResultMap" type="java.util.Map">
		<!--
			WARNING - @mbggenerated This element is automatically generated by
			MyBatis Generator, do not modify.
		-->

		<result column="Channel_Type" property="ChannelType" jdbcType="VARCHAR" />
		<result column="Article_No" property="ArticleNo" jdbcType="VARCHAR" />
		<result column="Article_Title" property="ArticleTitle"
			jdbcType="VARCHAR" />
		<result column="Platform_Category" property="PlatformCategory"
			jdbcType="VARCHAR" />
		<result column="Seller_Category" property="SellerCategory"
			jdbcType="VARCHAR" />
		<result column="Orig_Price" property="OrigPrice" jdbcType="DECIMAL" />
		<result column="Sale_Price" property="SalePrice" jdbcType="DECIMAL" />
		<result column="Postage_Type" property="PostageType" jdbcType="VARCHAR" />
		<result column="Article_Images" property="ArticleImages"
			jdbcType="VARCHAR" />
		<result column="Color_Images" property="ColorImages" jdbcType="VARCHAR" />
		<result column="Description" property="Description" jdbcType="VARCHAR" />
		<result column="Model_No" property="ModelNo" jdbcType="VARCHAR" />
		<result column="Gender" property="Gender" jdbcType="VARCHAR" />
		<result column="Brand" property="Brand" jdbcType="VARCHAR" />
		<result column="reverse_4" property="Reverse4" jdbcType="VARCHAR" />
		<result column="Sku_Code" property="SkuCode" jdbcType="VARCHAR" />
		<result column="Color_Name" property="ColorName" jdbcType="VARCHAR" />
		<result column="Size_Name" property="SizeName" jdbcType="VARCHAR" />
		<result column="Sku_Price" property="SkuPrice" jdbcType="DECIMAL" />
		<result column="Sku_Stock" property="SkuStock" jdbcType="INTEGER" />
		<result column="Sku_Reverse_1" property="SkuReverse1" jdbcType="VARCHAR" />
		<result column="Sku_Reverse_2" property="SkuReverse2" jdbcType="VARCHAR" />
		<result column="Sku_Reverse_3" property="SkuReverse3" jdbcType="VARCHAR" />
		<result column="Sku_Reverse_4" property="SkuReverse4" jdbcType="VARCHAR" />
		<result column="Sku_Reverse_5" property="SkuReverse5" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!--
			WARNING - @mbggenerated This element is automatically generated by
			MyBatis Generator, do not modify.
		-->
		'Official' Channel_Type,t.Item_cd Article_No,isnull(t.item_name,i.title) Article_Title,''
		Platform_Category,
		REPLACE(i.seller_cids,',',';')
		Seller_Category,i.price Orig_Price,
		i.price Sale_Price,''
		Postage_Type,'' Article_Images,'' Color_Images,''
		Description,
		t.Model_no Model_No,t.Gender Gender,t.Brand Brand,''
		reverse_4,s.outer_id
		Sku_Code,
		t.Color_name Color_Name,case Size_name when null then '均码' when '' then '均码' else Size_name end
		Size_Name,s.price Sku_Price,0 Sku_Stock,
		'' Sku_Reverse_1,''
		Sku_Reverse_2,'' Sku_Reverse_3,'' Sku_Reverse_4,''
		Sku_Reverse_5
	</sql>
	<select id="searchArticle" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		<!--
			WARNING - @mbggenerated This element is automatically generated by
			MyBatis Generator, do not modify.
		-->
		select distinct 
		<include refid="Base_Column_List" />
		from OfficialPlugIn .dbo.Official_article_temp t
		inner join
		TaoBaoPlugIn.dbo.item i on t.Item_cd = i.item_cd
		left join
		TaoBaoPlugIn.dbo.sku s on i.item_id = s.Item_id
		<if test="Flag != null">
			where t.flag = ${Flag}
		</if>
		<if test="PjId != null">
			and i.pj_id = ${PjId}
		</if>
		<if test="StoreId != null">
			and i.store_id = ${StoreId}
		</if>
	</select>
	<resultMap id="ItemResultMap" type="java.util.Map">
		<id column="Item_cd" property="ArticleNo" jdbcType="VARCHAR" />
		<result column="Channel_Type" property="ChannelType" jdbcType="VARCHAR" />
		<result column="Item_Price_update_time" property="PriceUpdateTime"
			jdbcType="TIMESTAMP" />
		<result column="Item_Stock_update_time" property="StockUpdateTime"
			jdbcType="TIMESTAMP" />
		<collection property="skuList" javaType="java.util.List" ofType="java.util.Map">
			<id column="Sku_cd" property="SkuCd" jdbcType="VARCHAR" />
			<id column="Item_cd" property="ArticleNo" jdbcType="VARCHAR" />
			<result column="Price" property="Price" jdbcType="DECIMAL" />
			<result column="Stock" property="Stock" jdbcType="INTEGER" />
			<result column="Price_flag" property="PriceFlag" jdbcType="INTEGER" />
			<result column="Stock_flag" property="StockFlag" jdbcType="INTEGER" />
			<result column="Price_update_time" property="PriceUpdateTime"
				jdbcType="TIMESTAMP" />
			<result column="Stock_update_time" property="StockUpdateTime"
				jdbcType="TIMESTAMP" />
		</collection>
	</resultMap>
	<sql id="Item_Column_List">
		'Official' Channel_Type,i.Item_cd,i.Price_update_time Item_Price_update_time,i.Stock_update_time Item_Stock_update_time,
		s.Sku_cd,s.Price,s.Stock,s.Price_flag,s.Stock_flag,s.Price_update_time,s.Stock_update_time
	</sql>
	<select id="searchItemPriceOrStock" resultMap="ItemResultMap"
		parameterType="java.util.Map">
		select distinct 
		<include refid="Item_Column_List" />
		from Item i left join Sku s on i.Item_cd = s.Item_cd where i.Pj_id = ${PjId} and i.Store_id = ${StoreId}
		<if test="PriceFlag != null">
			and isnull(s.Price_flag,0) = ${PriceFlag}
    	</if>
		<if test="StockFlag != null">
			and isnull(s.Stock_flag,0) = ${StockFlag}
    	</if>
	</select>
  <update id="callPriceUpdateSP" parameterType="java.util.Map" >
	DECLARE	@return_value int	
	EXEC	@return_value = [EcAsp].[dbo].[ApTp_AdidasOfficialPriceUpdateFromAmi]
			@Bat_Record_ID = 0,
			@pj_id = ${PjId},
			@Store_id = ${StoreId}	
	SELECT	'Return Value' = @return_value
  </update>
</mapper>