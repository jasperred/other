<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ami.ec.channel.dao.asp.WsOrderSearchMapper" >
  <resultMap id="BaseResultMap" type="com.ami.ec.channel.domain.asp.OrderHeadForWs" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="Rtn" property="rtn" jdbcType="INTEGER" />
    <result column="Orig_order_type" property="origOrderType" jdbcType="VARCHAR" />
    <result column="Order_no" property="orderNo" jdbcType="VARCHAR" />
    <result column="Orig_order_no" property="origOrderNo" jdbcType="VARCHAR" />
    <result column="buyer_nick" property="buyerNick" jdbcType="VARCHAR" />
    <result column="Actual_total_amt" property="actualTotalAmt" jdbcType="DECIMAL" />
    <result column="post_fee" property="postFee" jdbcType="DECIMAL" />
    <result column="Pay_point" property="payPoint" jdbcType="INTEGER" />
    <result column="Actual_receive_point" property="actualReceivePoint" jdbcType="INTEGER" />
    <result column="Order_status" property="orderStatus" jdbcType="VARCHAR" />
    <result column="receiver_name" property="receiverName" jdbcType="VARCHAR" />
    <result column="City" property="city" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="distrinct" property="distrinct" jdbcType="VARCHAR" />
    <result column="Zip" property="zip" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="Shipping_type" property="shippingType" jdbcType="VARCHAR" />
    <result column="shipping_company_no" property="shippingCompanyNo" jdbcType="VARCHAR" />
    <result column="shipping_company" property="shippingCompany" jdbcType="VARCHAR" />
    <result column="Shipping_ref_no" property="ShippingRefNo" jdbcType="VARCHAR" />
    <result column="Phone" property="phone" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="Order_date" property="orderDate" jdbcType="TIMESTAMP" />
    <result column="Remark" property="remark" jdbcType="VARCHAR" />
    <result column="Email" property="email" jdbcType="VARCHAR" />
    <result column="orig_order_status" property="origOrderStatus" jdbcType="VARCHAR" />
    <result column="Delivery_date" property="deliveryDate" jdbcType="TIMESTAMP" />
    <result column="timestamp" property="timestamp" jdbcType="TIMESTAMP" />
    <result column="log_time" property="logTime" jdbcType="TIMESTAMP" />
    <collection property="orderLineList" ofType="com.ami.ec.channel.domain.asp.OrderLineForWs">
	    <id column="Order_line_id" property="orderLineId" jdbcType="VARCHAR" />
	 	<result column="Disp_index" property="dispIndex" jdbcType="INTEGER" />
	    <result column="Sku_cd" property="skuCd" jdbcType="VARCHAR" />
	    <result column="title" property="title" jdbcType="VARCHAR" />
	    <result column="color" property="color" jdbcType="VARCHAR" />
	    <result column="size" property="size" jdbcType="VARCHAR" />
	    <result column="price" property="price" jdbcType="DECIMAL" />
	    <result column="qty" property="qty" jdbcType="INTEGER" />
	    <result column="discount" property="discount" jdbcType="DECIMAL" />
	    <result column="amt" property="amt" jdbcType="DECIMAL" />
	    <result column="Remark" property="remark" jdbcType="VARCHAR" />
	</collection>
  </resultMap>
  <resultMap id="OrderHeadIdResult" type="java.lang.Integer" >
    <result column="Zlog_id" property="zlogId" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    h.Rtn, h.Orig_order_type, h.Order_no, h.Orig_order_no, u.Unit_no_1 buyer_nick,h.Actual_total_amt,h.Freight_amt_1 post_fee,h.Pay_point,
    h.Actual_receive_point,h.Order_status,h.Add_name receiver_name,h.City,h.Country state,h.Area_or_loc distrinct,h.Zip,h.Address_1 address,
    h.Shipping_type,isnull(ca.Unit_no,'') shipping_company_no,isnull(ca.Unit_name,'') shipping_company,h.Shipping_ref_no,h.Phone,
    h.Fax mobile,h.Order_date,h.Remark,h.Email,h.User_field_3 orig_order_status,h.Delivery_date,h.Stamp timestamp,h.Zlog_time log_time,
    l.Order_line_id,l.Disp_index,s.Sku_cd,l.Orig_item_name title,s.Sku_name_1 color,s.Sku_name_2 size,l.P_price price,l.Ref_qty qty,l.P_discount discount,l.P_amt amt,l.Remark
  </sql>
  <select id="selectByIncrementCount" resultMap="OrderHeadIdResult" parameterType="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <if test="top" >
      top ${top}
    </if>
    Zlog_id from Zlog_Order_head h where h.Order_type = 'OD' 
    <if test="_parameter != null" >
      <if test="PjId != null" >
      	and h.Pj_id = ${PjId}
      </if>
      <if test="StoreId != null" >
      	and h.Supp_id = ${StoreId}
      </if>
      <if test="OrigOrderType != null" >
      	and h.Orig_order_type = '${OrigOrderType}'
      </if>
      <if test="FromDate != null" >
      	and h.Zlog_time > '${FromDate}'
      </if>
      <if test="TimeStamp != null" >
      	and CONVERT(varchar, h.Stamp) > '${TimeStamp}'
      </if>
    </if>
      order by h.Zlog_time,h.Stamp
  </select>
  <select id="selectByIncrement" resultMap="BaseResultMap" parameterType="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from Zlog_Order_head h left join Order_line l on h.Order_head_id = l.Order_head_id left join Unit u on h.Cust_id = u.Unit_id left join Unit ca on h.Carrier_Id = ca.Unit_id left join asp.dbo.Sku_master s on l.Sku_id = s.Sku_id
    where h.Zlog_id in (${ZlogId}) order by h.Zlog_time,h.Stamp
  </select>
  <sql id="Base_Column_List2" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    h.Rtn, h.Orig_order_type, h.Order_no, h.Orig_order_no, u.Unit_no_1 buyer_nick,h.Actual_total_amt,h.Freight_amt_1 post_fee,h.Pay_point,
    h.Actual_receive_point,h.Order_status,h.Add_name receiver_name,h.City,h.Country state,h.Area_or_loc distrinct,h.Zip,h.Address_1 address,
    h.Shipping_type,isnull(ca.Unit_no,'') shipping_company_no,isnull(ca.Unit_name,'') shipping_company,h.Shipping_ref_no,h.Phone,
    h.Fax mobile,h.Order_date,h.Remark,h.Email,h.User_field_3 orig_order_status,h.Delivery_date,h.Stamp timestamp,h.Operate_time log_time,
    l.Order_line_id,l.Disp_index,s.Sku_cd,l.Orig_item_name title,s.Sku_name_1 color,s.Sku_name_2 size,l.P_price price,l.Ref_qty qty,l.P_discount discount,l.P_amt amt,l.Remark
  </sql>
  <select id="selectByConditionCount" resultMap="OrderHeadIdResult" parameterType="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <if test="top" >
      top ${top}
    </if>
     Order_head_id from Order_head h where h.Order_type = 'OD' 
    <if test="_parameter != null" >
      <if test="PjId != null" >
      	and h.Pj_id = ${PjId}
      </if>
      <if test="StoreId != null" >
      	and h.Supp_id in (${StoreId})
      </if>
      <if test="Rtn != null" >
      	and h.Rtn = ${Rtn}
      </if>
      <if test="OrigOrderType != null" >
      	and h.Orig_order_type = '${OrigOrderType}'
      </if>
      <if test="OrigOrderNo != null" >
      	and h.Orig_order_no = '${OrigOrderNo}'
      </if>
      <if test="ReceiverTel != null" >
      	and (h.Phone = '${ReceiverTel}' or 'h.Fax = ${ReceiverTel})'
      </if>
    </if>
      order by h.Request_date desc
  </select>
  <select id="selectByCondition" resultMap="BaseResultMap" parameterType="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List2" />
    from Order_head h left join Order_line l on h.Order_head_id = l.Order_head_id left join Unit u on h.Cust_id = u.Unit_id left join Unit ca on h.Carrier_Id = ca.Unit_id  left join asp.dbo.Sku_master s on l.Sku_id = s.Sku_id
    where h.Order_type = 'OD' 
    <if test="_parameter != null" >
      <if test="PjId != null" >
      	and h.Pj_id = ${PjId}
      </if>
      <if test="StoreId != null" >
      	and h.Supp_id in (${StoreId})
      </if>
      <if test="OrigOrderType != null" >
      	and h.Orig_order_type = '${OrigOrderType}'
      </if>
      <if test="OrigOrderNo != null" >
      	and h.Orig_order_no = '${OrigOrderNo}'
      </if>
      <if test="ReceiverTel != null" >
      	and (h.Phone = '${ReceiverTel}' or h.Fax = '${ReceiverTel}')
      </if>
      <if test="BuyerNick != null" >
      	and u.Unit_no_1 = '${BuyerNick}'
      </if>
    </if>
      order by h.Request_date desc
  </select>
  <resultMap id="DeliverResultMap" type="java.util.Map" >
    <result column="orig_order_type" property="ChannelType" jdbcType="VARCHAR" />
    <result column="Orig_order_no" property="OrderNo" jdbcType="VARCHAR" />
    <result column="Unit_no" property="PostType" jdbcType="VARCHAR" />
    <result column="Unit_name" property="DeliverCompany" jdbcType="VARCHAR" />
    <result column="Shipping_ref_no" property="DeliverNo" jdbcType="VARCHAR" />
    <result column="Delivery_date" property="DeliverTime" jdbcType="TIMESTAMP" />
    
  </resultMap>
  <sql id="Deliver_Column_List" >
    oh.orig_order_type,oh.Orig_order_no,u.Unit_no,u.Unit_name,oh.Shipping_ref_no,oh.Delivery_date
  </sql>
  <select id="selectByDeliverResult" resultMap="DeliverResultMap" parameterType="java.util.Map" >
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Deliver_Column_List" />
    from Order_head oh left join Unit u on oh.Carrier_Id = u.Unit_id where oh.Rtn = 1 and oh.Order_status = 40 
    <if test="_parameter != null" >
      <if test="PjId != null" >
      	and oh.Pj_id = ${PjId}
      </if>
      <if test="StoreId != null" >
      	and oh.Supp_id = ${StoreId}
      </if>
      <if test="OrigOrderType != null" >
      	and oh.Orig_order_type = '${OrigOrderType}'
      </if>
    </if>
      order by oh.Delivery_date
  </select>
  <resultMap id="ReturnResultMap" type="java.util.Map" >
    <result column="orig_order_type" property="ChannelType" jdbcType="VARCHAR" />
    <result column="refund_no" property="OrderNo" jdbcType="VARCHAR" />
    <result column="order_no" property="OrigOrderNo" jdbcType="VARCHAR" />
    <result column="Item_cd" property="ArticleNo" jdbcType="VARCHAR" />
    <result column="Sku_cd" property="SkuCode" jdbcType="VARCHAR" />
    <result column="Qty" property="Num" jdbcType="INTEGER" />
    
  </resultMap>
  <sql id="Return_Column_List" >
    rh.orig_order_type,rh.Orig_order_no refund_no, oh.Orig_order_no order_no,im.Item_cd,sm.Sku_cd,ol.Qty
  </sql>
  <select id="selectByReturnResult" resultMap="ReturnResultMap" parameterType="java.util.Map" >
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Return_Column_List" />
    from Order_head rh 
left join Order_head oh on rh.Ref_order_id = oh.Order_head_id
left join Order_line ol on rh.Order_head_id = ol.Order_head_id
left join Sku_master sm on ol.Sku_id = sm.Sku_id
left join Item_master im on sm.Item_id = im.Item_id where rh.Rtn = -1 and rh.Order_status = 40
    <if test="_parameter != null" >
      <if test="PjId != null" >
      	and rh.Pj_id = ${PjId}
      </if>
      <if test="StoreId != null" >
      	and rh.Supp_id = ${StoreId}
      </if>
      <if test="OrigOrderType != null" >
      	and rh.Orig_order_type = '${OrigOrderType}'
      </if>
    </if>
      order by rh.Delivery_date
  </select>
</mapper>